<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketChain UMKM - Real-Time Blockchain Payment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .blockchain-status {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 18px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #007bff;
            color: white;
            transform: translateY(-2px);
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .hidden {
            display: none;
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .product-card {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            background: #fff;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .product-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        /* Payment Processing */
        .payment-processing {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            border: 2px solid #f1c40f;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .payment-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        /* Blockchain Block */
        .block {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .block:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .transaction-detail {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }

        /* Financial Report Styles */
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .finance-card {
            background: linear-gradient(135deg, #2196f3, #21cbf3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .finance-card:hover {
            transform: translateY(-5px);
        }

        .finance-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Real-time updates */
        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            animation: blink 1s infinite;
            margin-right: 8px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success { background: #28a745; }
        .notification.error { background: #dc3545; }
        .notification.info { background: #17a2b8; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Implementation Flow */
        .implementation-flow {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .flow-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .tabs { flex-direction: column; }
            .product-grid { grid-template-columns: 1fr; }
            .financial-summary { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíé MarketChain UMKM</h1>
            <p>Real-Time Blockchain Payment System - Setiap Transaksi Langsung Tercatat</p>
            <div class="blockchain-status">
                <span class="live-indicator"></span>
                <strong>Blockchain Status:</strong> <span id="blockchainStatus">LIVE & READY</span> | 
                <strong>Total Blocks:</strong> <span id="totalBlocks">0</span> |
                <strong>Last Block:</strong> <span id="lastBlockTime">-</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('marketplace', this)">üõí Marketplace</button>
            <button class="tab" onclick="showTab('financial', this)">üí∞ Laporan Keuangan</button>
            <button class="tab" onclick="showTab('blockchain', this)">‚õìÔ∏è Blockchain Records</button>
            <button class="tab" onclick="showTab('implementation', this)">üîß Cara Kerja</button>
        </div>

        <!-- Marketplace Tab -->
        <div id="marketplace" class="content">
            <h2>üõçÔ∏è Marketplace UMKM - Pembayaran Real-Time Blockchain</h2>
            
            <div class="product-grid" id="productGrid"></div>
            
            <div id="cart" style="margin-top: 30px;"></div>
            
            <div id="paymentSection" class="hidden">
                <h3>üí≥ Proses Pembayaran Instant</h3>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 15px; margin: 20px 0;">
                    <h4>üìã Data Pembeli</h4>
                    <input type="text" id="buyerName" placeholder="Nama Lengkap" style="width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="email" id="buyerEmail" placeholder="Email" style="width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="tel" id="buyerPhone" placeholder="Nomor HP" style="width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <textarea id="buyerAddress" placeholder="Alamat Lengkap" style="width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" rows="3"></textarea>
                    <select id="paymentMethod" style="width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="bank_transfer">üè¶ Transfer Bank</option>
                        <option value="ewallet">üì± E-Wallet (GoPay/OVO/DANA)</option>
                        <option value="crypto">‚Çø Cryptocurrency</option>
                        <option value="cod">üíµ Cash on Delivery</option>
                    </select>
                </div>
                
                <button class="btn btn-success" onclick="processInstantPayment()" style="width: 100%; padding: 15px; font-size: 18px;">
                    ‚ö° BAYAR SEKARANG & CATAT KE BLOCKCHAIN
                </button>
            </div>
            
            <div id="paymentResult"></div>
        </div>

        <!-- Financial Report Tab -->
        <div id="financial" class="content hidden">
            <h2>üí∞ Laporan Keuangan Real-Time</h2>
            <p style="color: #666; margin-bottom: 25px;">Data keuangan yang terintegrasi langsung dengan blockchain</p>
            
            <div class="financial-summary">
                <div class="finance-card">
                    <div class="finance-value" id="totalIncome">Rp 0</div>
                    <div>Total Pendapatan</div>
                </div>
                <div class="finance-card" style="background: linear-gradient(135deg, #28a745, #20c997);">
                    <div class="finance-value" id="totalProfit">Rp 0</div>
                    <div>Total Keuntungan</div>
                </div>
                <div class="finance-card" style="background: linear-gradient(135deg, #ffc107, #ffed4a);">
                    <div class="finance-value" id="totalTax">Rp 0</div>
                    <div>Total Pajak (11%)</div>
                </div>
                <div class="finance-card" style="background: linear-gradient(135deg, #dc3545, #e85d75);">
                    <div class="finance-value" id="operationalCost">Rp 0</div>
                    <div>Biaya Operasional</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                <div>
                    <h3>üìä Ringkasan Transaksi Hari Ini</h3>
                    <div id="dailyTransactions"></div>
                </div>
                <div>
                    <h3>üíé Laporan Blockchain Verified</h3>
                    <div id="blockchainFinancial"></div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3>üìà Grafik Pendapatan (Simulasi)</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center;">
                    <canvas id="revenueChart" width="400" height="200" style="max-width: 100%;"></canvas>
                </div>
            </div>
        </div>

        <!-- Blockchain Records Tab -->
        <div id="blockchain" class="content hidden">
            <h2>‚õìÔ∏è Live Blockchain Transaction Records</h2>
            <p style="color: #666; margin-bottom: 25px;">Semua transaksi tercatat real-time tanpa pending</p>
            
            <div style="display: flex; gap: 20px; margin-bottom: 25px;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; flex: 1; text-align: center;">
                    <strong>Chain Length:</strong> <span id="chainLength">0</span>
                </div>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 10px; flex: 1; text-align: center;">
                    <strong>Total Transactions:</strong> <span id="chainTransactions">0</span>
                </div>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; flex: 1; text-align: center;">
                    <strong>Chain Hash:</strong> <span id="chainHash">-</span>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-success" onclick="validateBlockchain()">‚úÖ Validate Chain Integrity</button>
                <button class="btn btn-warning" onclick="exportBlockchainData()">üì• Export All Data</button>
            </div>
            
            <div id="blockchainRecords"></div>
        </div>

        <!-- Implementation Tab -->
        <div id="implementation" class="content hidden">
            <h2>üîß Cara Kerja MarketChain UMKM</h2>
            
            <div class="implementation-flow">
                <h3>üí° Konsep Dasar</h3>
                <p style="margin-bottom: 20px;">MarketChain UMKM menggunakan blockchain untuk mencatat setiap transaksi secara real-time, transparent, dan immutable (tidak bisa diubah).</p>
                
                <div class="flow-step">
                    <div class="flow-number">1</div>
                    <div>
                        <strong>Customer memilih produk</strong><br>
                        Customer browse produk UMKM dan menambahkan ke keranjang
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-number">2</div>
                    <div>
                        <strong>Instant Payment Processing</strong><br>
                        Customer isi data dan pilih metode pembayaran, sistem langsung proses tanpa pending
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-number">3</div>
                    <div>
                        <strong>Real-time Blockchain Recording</strong><br>
                        Transaksi langsung di-hash dan ditambahkan ke blockchain sebagai block baru
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-number">4</div>
                    <div>
                        <strong>Financial Integration</strong><br>
                        Data transaksi otomatis masuk ke laporan keuangan (pendapatan, pajak, keuntungan)
                    </div>
                </div>
                
                <div class="flow-step">
                    <div class="flow-number">5</div>
                    <div>
                        <strong>Immutable Record</strong><br>
                        Data sudah tercatat permanen di blockchain dan bisa diaudit kapan saja
                    </div>
                </div>
            </div>
            
            <div style="background: #fff3cd; padding: 25px; border-radius: 15px; margin: 25px 0;">
                <h4>üèóÔ∏è Implementasi Teknis</h4>
                <ul style="padding-left: 20px; line-height: 2;">
                    <li><strong>Frontend:</strong> HTML5, CSS3, JavaScript (dapat diintegrasikan dengan React/Vue)</li>
                    <li><strong>Blockchain:</strong> Custom lightweight blockchain dengan SHA-256 hashing</li>
                    <li><strong>Database:</strong> Dapat menggunakan MongoDB/PostgreSQL untuk metadata</li>
                    <li><strong>Payment Gateway:</strong> Integrasi dengan Midtrans, Xendit, atau Stripe</li>
                    <li><strong>Backend:</strong> Node.js/Express atau PHP Laravel untuk API</li>
                    <li><strong>Real-time:</strong> WebSocket untuk update status real-time</li>
                </ul>
            </div>
            
            <div style="background: #d4edda; padding: 25px; border-radius: 15px;">
                <h4>‚úÖ Keunggulan Sistem Ini</h4>
                <ul style="padding-left: 20px; line-height: 2;">
                    <li><strong>Transparansi:</strong> Setiap transaksi dapat diverifikasi oleh siapa saja</li>
                    <li><strong>Audit Trail:</strong> Riwayat lengkap tidak bisa dihapus atau dimanipulasi</li>
                    <li><strong>Real-time:</strong> Tidak ada delay, transaksi langsung tercatat</li>
                    <li><strong>Cost Effective:</strong> Tidak perlu cryptocurrency, menggunakan mata uang normal</li>
                    <li><strong>UMKM Friendly:</strong> Interface sederhana, tidak perlu pengetahuan teknis</li>
                    <li><strong>Compliance:</strong> Mendukung pelaporan pajak dan audit keuangan</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Simple & Fast Blockchain System
        class TransactionBlock {
            constructor(index, timestamp, transactionData, previousHash) {
                this.index = index;
                this.timestamp = timestamp;
                this.transactionData = transactionData;
                this.previousHash = previousHash || "0";
                this.hash = this.calculateSimpleHash();
            }

            calculateSimpleHash() {
                // Super simple and fast hash function
                const data = this.index + this.previousHash + this.timestamp + JSON.stringify(this.transactionData);
                let hash = 0;
                
                for (let i = 0; i < data.length; i++) {
                    hash = ((hash << 3) + hash + data.charCodeAt(i)) & 0x7fffffff;
                }
                
                return hash.toString(16).padStart(8, '0');
            }
        }

        class RealTimeBlockchain {
            constructor() {
                this.chain = [];
                this.financialData = {
                    totalIncome: 0,
                    totalProfit: 0,
                    totalTax: 0,
                    operationalCost: 0,
                    dailyTransactions: []
                };
            }

            getLatestBlock() {
                return this.chain.length > 0 ? this.chain[this.chain.length - 1] : null;
            }

            addTransactionBlock(transactionData) {
                const timestamp = new Date().toISOString();
                const previousHash = this.getLatestBlock() ? this.getLatestBlock().hash : "0";
                
                // Enhanced transaction data with financial calculations
                const enhancedTransaction = {
                    ...transactionData,
                    transactionId: 'TXN-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6),
                    blockIndex: this.chain.length,
                    status: 'CONFIRMED',
                    tax: Math.round(transactionData.total * 0.11), // 11% tax
                    platformFee: Math.round(transactionData.total * 0.025), // 2.5% platform fee
                    sellerProfit: Math.round(transactionData.total * 0.865), // 86.5% to seller
                    timestamp: timestamp
                };

                // Create new block instantly (no mining)
                const newBlock = new TransactionBlock(
                    this.chain.length,
                    timestamp,
                    enhancedTransaction,
                    previousHash
                );
                
                // Add to chain immediately
                this.chain.push(newBlock);
                
                // Update financial data
                this.updateFinancialData(enhancedTransaction);
                
                // Update UI
                this.updateBlockchainStatus();
                
                return {
                    success: true,
                    block: newBlock,
                    transactionId: enhancedTransaction.transactionId,
                    processingTime: 'INSTANT'
                };
            }

            updateFinancialData(transaction) {
                this.financialData.totalIncome += transaction.total;
                this.financialData.totalTax += transaction.tax;
                this.financialData.operationalCost += transaction.platformFee;
                this.financialData.totalProfit += transaction.sellerProfit;
                
                // Add to daily transactions
                const today = new Date().toISOString().split('T')[0];
                const dailyTx = this.financialData.dailyTransactions.find(d => d.date === today);
                if (dailyTx) {
                    dailyTx.amount += transaction.total;
                    dailyTx.count += 1;
                } else {
                    this.financialData.dailyTransactions.push({
                        date: today,
                        amount: transaction.total,
                        count: 1
                    });
                }
            }

            updateBlockchainStatus() {
                document.getElementById('totalBlocks').textContent = this.chain.length;
                document.getElementById('chainLength').textContent = this.chain.length;
                document.getElementById('chainTransactions').textContent = this.chain.length;
                
                if (this.chain.length > 0) {
                    const lastBlock = this.getLatestBlock();
                    document.getElementById('lastBlockTime').textContent = new Date(lastBlock.timestamp).toLocaleString('id-ID');
                    document.getElementById('chainHash').textContent = lastBlock.hash.substring(0, 8) + '...';
                }
            }

            validateChain() {
                // Simple and fast chain validation
                for (let i = 1; i < this.chain.length; i++) {
                    const currentBlock = this.chain[i];
                    const previousBlock = this.chain[i - 1];

                    // Check if current block hash is valid
                    if (currentBlock.hash !== currentBlock.calculateSimpleHash()) {
                        return { valid: false, error: `Block ${i} has invalid hash` };
                    }

                    // Check if previous hash matches
                    if (currentBlock.previousHash !== previousBlock.hash) {
                        return { valid: false, error: `Block ${i} has invalid previous hash` };
                    }
                }
                return { valid: true };
            }

            exportData() {
                const exportData = {
                    blockchain: this.chain,
                    financialData: this.financialData,
                    exportTime: new Date().toISOString(),
                    totalBlocks: this.chain.length,
                    chainValid: this.validateChain().valid
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `marketchain-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Data blockchain berhasil diekspor!', 'success');
            }
        }

        // Global Variables
        let blockchain = new RealTimeBlockchain();
        let products = [
            { id: 1, name: "Batik Tulis Jogja Premium", price: 350000, stock: 15, seller: "Batik Nusantara", emoji: "üëò", cost: 200000 },
            { id: 2, name: "Keripik Singkong Balado", price: 25000, stock: 100, seller: "Kedai Ranah", emoji: "üå∂Ô∏è", cost: 15000 },
            { id: 3, name: "Tas Rajut Handmade", price: 125000, stock: 25, seller: "Rajut Nusantara", emoji: "üëú", cost: 75000 },
            { id: 4, name: "Kopi Robusta Premium", price: 65000, stock: 50, seller: "Kopi Pegunungan", emoji: "‚òï", cost: 35000 },
            { id: 5, name: "Sandal Kulit Asli", price: 180000, stock: 30, seller: "Leather Craft", emoji: "üë°", cost: 120000 },
        ];
        let cart = [];

        // UI Functions
        function showTab(tabName, tabElement) {
            document.querySelectorAll('.content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            tabElement.classList.add('active');
            
            if (tabName === 'marketplace') {
                displayProducts();
                updateCart();
            } else if (tabName === 'financial') {
                updateFinancialReport();
            } else if (tabName === 'blockchain') {
                displayBlockchainRecords();
            }
        }

        function displayProducts() {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = '';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">${product.emoji}</div>
                    <h3>${product.name}</h3>
                    <p style="font-weight: bold; color: #007bff; font-size: 1.3em;">Rp ${product.price.toLocaleString('id-ID')}</p>
                    <p style="font-size: 12px; color: #666;">üè™ ${product.seller} | Stock: ${product.stock}</p>
                    <button class="btn" onclick="addToCart(${product.id})">
                        ‚ûï Tambah ke Keranjang
                    </button>
                `;
                productGrid.appendChild(productCard);
            });
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            
            updateCart();
            showNotification(`${product.name} ditambahkan ke keranjang!`, 'success');
        }

        function updateCart() {
            const cartDiv = document.getElementById('cart');
            const paymentSection = document.getElementById('paymentSection');
            
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p style="text-align: center; color: #666;">Keranjang kosong</p>';
                paymentSection.classList.add('hidden');
                return;
            }
            
            let total = 0;
            let cartHTML = '<h3>üõí Keranjang Belanja</h3>';
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                cartHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>Rp ${item.price.toLocaleString('id-ID')} x ${item.quantity}</small>
                        </div>
                        <div>
                            <strong>Rp ${itemTotal.toLocaleString('id-ID')}</strong>
                            <button class="btn btn-danger" style="padding: 5px 10px; margin-left: 10px;" onclick="removeFromCart(${item.id})">‚ùå</button>
                        </div>
                    </div>
                `;
            });
            
            cartHTML += `
                <div style="text-align: center; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <h4>Total: Rp ${total.toLocaleString('id-ID')}</h4>
                </div>
            `;
            
            cartDiv.innerHTML = cartHTML;
            paymentSection.classList.remove('hidden');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }

        function processInstantPayment() {
            if (cart.length === 0) {
                showNotification('Keranjang kosong!', 'error');
                return;
            }
            
            const buyerName = document.getElementById('buyerName').value.trim();
            const buyerEmail = document.getElementById('buyerEmail').value.trim();
            const buyerPhone = document.getElementById('buyerPhone').value.trim();
            const buyerAddress = document.getElementById('buyerAddress').value.trim();
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            if (!buyerName || !buyerEmail || !buyerPhone || !buyerAddress) {
                showNotification('Mohon lengkapi semua data pembeli!', 'error');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Show quick processing
            const resultDiv = document.getElementById('paymentResult');
            resultDiv.innerHTML = `
                <div class="payment-processing">
                    <h3>‚ö° Memproses Pembayaran...</h3>
                    <p>Sedang mencatat transaksi ke blockchain...</p>
                </div>
            `;
            
            // Process payment immediately (no delay)
            setTimeout(() => {
                const transactionData = {
                    buyerInfo: {
                        name: buyerName,
                        email: buyerEmail,
                        phone: buyerPhone,
                        address: buyerAddress
                    },
                    items: [...cart],
                    total: total,
                    paymentMethod: paymentMethod,
                    orderNumber: 'ORDER-' + Date.now(),
                    processingTime: new Date().toISOString()
                };
                
                // Add to blockchain instantly
                const result = blockchain.addTransactionBlock(transactionData);
                
                if (result.success) {
                    // Update product stocks
                    cart.forEach(cartItem => {
                        const product = products.find(p => p.id === cartItem.id);
                        if (product) {
                            product.stock -= cartItem.quantity;
                        }
                    });
                    
                    // Success message
                    resultDiv.innerHTML = `
                        <div class="payment-success">
                            <h3>‚úÖ Pembayaran Berhasil!</h3>
                            <p><strong>Order Number:</strong> ${transactionData.orderNumber}</p>
                            <p><strong>Transaction ID:</strong> ${result.transactionId}</p>
                            <p><strong>Total:</strong> Rp ${total.toLocaleString('id-ID')}</p>
                            <p><strong>Block Hash:</strong> ${result.block.hash}</p>
                            <p><strong>Processing:</strong> ${result.processingTime}</p>
                            <p>‚úÖ <strong>Transaksi telah tercatat INSTANT di blockchain!</strong></p>
                        </div>
                    `;
                    
                    // Clear cart and form
                    cart = [];
                    document.getElementById('buyerName').value = '';
                    document.getElementById('buyerEmail').value = '';
                    document.getElementById('buyerPhone').value = '';
                    document.getElementById('buyerAddress').value = '';
                    
                    updateCart();
                    updateFinancialReport();
                    
                    showNotification(`üíé Pembayaran berhasil! Block #${result.block.index} tercatat INSTANT!`, 'success');
                }
            }, 300); // Very quick processing - just 300ms
        }

        function updateFinancialReport() {
            const financial = blockchain.financialData;
            
            document.getElementById('totalIncome').textContent = `Rp ${financial.totalIncome.toLocaleString('id-ID')}`;
            document.getElementById('totalProfit').textContent = `Rp ${financial.totalProfit.toLocaleString('id-ID')}`;
            document.getElementById('totalTax').textContent = `Rp ${financial.totalTax.toLocaleString('id-ID')}`;
            document.getElementById('operationalCost').textContent = `Rp ${financial.operationalCost.toLocaleString('id-ID')}`;
            
            // Daily transactions
            const dailyDiv = document.getElementById('dailyTransactions');
            if (financial.dailyTransactions.length === 0) {
                dailyDiv.innerHTML = '<p style="color: #666;">Belum ada transaksi hari ini</p>';
            } else {
                dailyDiv.innerHTML = financial.dailyTransactions.map(day => `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                        <strong>üìÖ ${day.date}</strong><br>
                        üí∞ Rp ${day.amount.toLocaleString('id-ID')} (${day.count} transaksi)
                    </div>
                `).join('');
            }
            
            // Blockchain financial verification
            const blockchainFinDiv = document.getElementById('blockchainFinancial');
            const verifiedTotal = blockchain.chain.reduce((sum, block) => sum + (block.transactionData.total || 0), 0);
            blockchainFinDiv.innerHTML = `
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px;">
                    <strong>‚úÖ Verified by Blockchain</strong><br>
                    üíé Total Verified: Rp ${verifiedTotal.toLocaleString('id-ID')}<br>
                    ‚õìÔ∏è Blocks: ${blockchain.chain.length}<br>
                    üîí Status: ${blockchain.validateChain().valid ? 'VALID' : 'INVALID'}
                </div>
            `;
        }

        function displayBlockchainRecords() {
            const recordsDiv = document.getElementById('blockchainRecords');
            
            if (blockchain.chain.length === 0) {
                recordsDiv.innerHTML = '<p style="text-align: center; color: #666;">Belum ada transaksi tercatat</p>';
                return;
            }
            
            recordsDiv.innerHTML = blockchain.chain.slice().reverse().map(block => `
                <div class="block">
                    <div class="block-header">
                        <strong>Block #${block.index}</strong>
                        <span>${new Date(block.timestamp).toLocaleString('id-ID')}</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>üîó Hash:</strong> <code>${block.hash}</code><br>
                        <strong>üîó Previous Hash:</strong> <code>${block.previousHash}</code><br>
                        <strong>‚ö° Processing:</strong> INSTANT
                    </div>
                    <div class="transaction-detail">
                        <strong>üí≥ Transaction ID:</strong> ${block.transactionData.transactionId}<br>
                        <strong>üì¶ Order:</strong> ${block.transactionData.orderNumber}<br>
                        <strong>üë§ Buyer:</strong> ${block.transactionData.buyerInfo.name} (${block.transactionData.buyerInfo.email})<br>
                        <strong>üí∞ Total:</strong> Rp ${block.transactionData.total.toLocaleString('id-ID')}<br>
                        <strong>üí≥ Payment:</strong> ${block.transactionData.paymentMethod}<br>
                        <strong>üìä Tax (11%):</strong> Rp ${block.transactionData.tax.toLocaleString('id-ID')}<br>
                        <strong>üè™ Seller Profit:</strong> Rp ${block.transactionData.sellerProfit.toLocaleString('id-ID')}<br>
                        <strong>üì¶ Items:</strong> ${block.transactionData.items.map(item => `${item.name} (${item.quantity})`).join(', ')}
                    </div>
                </div>
            `).join('');
        }

        function validateBlockchain() {
            const result = blockchain.validateChain();
            if (result.valid) {
                showNotification('‚úÖ Blockchain integrity validated successfully! Chain is secure.', 'success');
            } else {
                showNotification(`‚ùå Blockchain validation failed: ${result.error}`, 'error');
            }
        }

        function exportBlockchainData() {
            blockchain.exportData();
        }

        function showNotification(message, type = 'info') {
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 4000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            displayProducts();
            updateCart();
            updateFinancialReport();
            blockchain.updateBlockchainStatus();
            
            // Add CSS for loading animation
            const style = document.createElement('style');
            style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
            document.head.appendChild(style);
            
            showNotification('MarketChain UMKM siap! Setiap transaksi akan langsung tercatat ke blockchain.', 'info');
        });
    </script>
</body>
</html>
